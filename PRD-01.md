4H「最近最低位 → 回抽高位（5根）→ 右二收盘入场」信号扫描器｜需求文档

仅为需求与口径说明；不包含任何实现/技术建议。
目标：输出最近30天内新出现的做空入场信号清单（极简结果）。

1. 目标与范围

目标：在 4 小时（4H）周期上，识别并输出符合下述形态定义的入场信号，不做回测、不评估收益。

市场范围：默认扫描USDT 计价现货对。

排除项：剔除杠杆/结构性代币（示例：UP/DOWN、BULL/BEAR、3L/3S/5L/5S 等）。

2. 关键口径定义
2.1 时间框架与锚点

K线周期：4H（固定）。

锚点起始：自 2025-08-01 00:00:00 UTC（含） 至“现在”。

2.2 PL（Pivot Low，最近最低位）

价格口径：最低价 L（PL以最低价为准，后续PH和入场判定以收盘价为准）。

取值规则：在锚点起始至"现在"的区间内，找到全局最低价格 L_min；若出现多次，**取最近一次（时间最晚）**作为 pl_idx。

扫描区间：仅在 ( pl_idx, 现在 ] 上进行后续判定。

2.3 PH（Pullback High，回抽高位）

由两层条件同时成立：

a) 五根窗口形态（用于“定位”）

以任意连续 5 根窗口 W = [i-2, i-1, i, i+1, i+2] 的**收盘价序列 C**判定：

左侧两根创新高（严格单调上行）：C[i-2] < C[i-1] < C[i]

右侧两根创新低（相对PH连续下跌）：
C[i+1] < C[i] 且
C[i+2] < C[i+1]

**包含容错规则**：
若 C[i+2] ≥ C[i+1]（右二反弹），但存在 C[i+3] < C[i+1]（右三继续下跌），则信号依然成立。
同理，若 C[i+3] ≥ C[i+2]，但存在 C[i+4] < C[i+2]，信号也成立。
此规则最多延伸到 C[i+4]。

满足以上关系时，i 为形态上的 PH。

所有候选 i 必须位于 (pl_idx, 现在]。

b) 区间极大（用于“强度”）

口径：仍以收盘价 C。

约束：C[i] 必须等于自 PL 之后至"现在" 的最高收盘价（允许极小数值误差范围内相等）。

c) 更低的高点（用于"趋势确认"）

约束：若存在先前的有效PH，当前PH的收盘价必须低于前一个PH的收盘价，确保形成下跌趋势中的"更低高点"模式。若当前PH高于前一个PH，则视为新的上涨趋势，信号无效。

仅当 a) 与 b) 与 c) 同时成立，i 才确认为 PH。

2.4 入场触发

触发时刻：当 i+2 这根 K 线收盘落成且 2.3 的 a)+b) 已成立。

入场价格：C[i+2]（i+2 的收盘价）。

入场时间：i+2 的收盘时间（UTC）。

近30天过滤：仅保留 i+2 收盘时间 ∈ [现在−30天, 现在] 的信号。

2.5 数据完整性

若 5 根窗口中任一根缺数据/无收盘/停牌，跳过该窗口。

极端异常蜡烛不单独处理；以收盘序列口径为准。

3. 输出规范（极简）

字段（建议，不限定实现形式）：

symbol（如 BTC/USDT）

timeframe（固定 4h）

pl_ts（PL 的收盘时间）

ph_close（C[i]，PH 的收盘价）

ph_ts（PH 的收盘时间）

entry_price（C[i+2]）

entry_ts（入场时间 = i+2 收盘）

排序：默认按 entry_ts 倒序（最近在前）。

去重：不强制；如需“每标的仅保留最近一次”，可在实现时提供选项。

4. 验收标准

抽检任意输出信号，在图上核验以下四点全部成立：

PL 为锚点以来的最近最低价（Low）；信号的窗口与 PH 均位于 (pl_idx, 现在]；

五根窗口满足：C[i-2] < C[i-1] < C[i] 且 C[i+1] < C[i] 且 (C[i+2] < C[i+1] 或包含容错规则成立) 且 C[i] < 前一个PH（如存在）；

PH 区间极大：C[i] 等于从 PL 之后至“现在” 的最高收盘；

入场定义：以 i+2 收盘时刻为触发，entry_price = C[i+2]，且 entry_ts 在近30天内。

5. 我的倾向（供实现时参考取舍）

仅表达偏好，不包含技术方案。

更少自写代码优先：可以多用稳定的成熟依赖来降低自写量。

结果尽量简短：只要保留必要字段的极简清单。

先把功能跑通：不追求优雅或扩展性，先满足本需求口径与近30天过滤。

开源优先：能用开源库就尽量用开源库；不强制限制依赖数量。